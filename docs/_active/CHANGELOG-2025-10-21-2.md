'''# Changelog - 21/10/2025 (Parte 2) ## Alterações Implementadas ### 1. Correção do Editor de Blog (TinyMCE) **Problema**: O editor de blog não carregava o TinyMCE, exibia botões duplicados e impedia a criação/edição de posts. **Solução**: - **Lógica de Botões**: A lógica de renderização dos botões "Salvar Rascunho" e "Publicar" foi reestruturada para eliminar a duplicação e garantir que apareçam corretamente com base no status do post e nas permissões do usuário. - **Carregamento do TinyMCE**: O `baseURL` para o carregamento do TinyMCE self-hosted foi corrigido, garantindo que o editor encontre seus arquivos de temas e plugins. - **Tratamento de Erros**: Adicionado um fallback visual que exibe uma mensagem de erro no `textarea` caso o editor falhe em carregar. **Arquivos modificados**: - `src/pages/BlogEditor.tsx` - `src/components/blog/TinyMCESelfHosted.tsx` --- ### 2. Correção no Sistema de Atribuição de Roles **Problema**: Usuários que recebiam um negócio como cortesia ou que assinavam um plano não estavam recebendo automaticamente a role "Associada" (`business_owner`). **Solução**: A lógica de atribuição da role `business_owner` foi adicionada em três pontos-chave do sistema: 1.  **Ao Conceder Cortesia**: Quando um administrador concede cortesia a um negócio existente, o sistema agora verifica se o proprietário do negócio já possui a role `business_owner`. Se não, a role é adicionada. 2.  **Ao Criar Negócio via Admin**: Ao criar um novo negócio para um usuário através do painel administrativo (e marcá-lo como cortesia), a role `business_owner` é automaticamente atribuída ao usuário. 3.  **No Webhook de Pagamento**: Quando um pagamento de assinatura é confirmado (evento `PAYMENT_CONFIRMED` no webhook do Asaas), o sistema agora atribui a role `business_owner` ao usuário correspondente. **Arquivos modificados**: - `src/components/admin/ComplimentaryBusinessManager.tsx` - `src/components/admin/AddBusinessDialog.tsx` - `supabase/functions/asaas-webhook/index.ts` --- ### 3. Localização (pt-BR) e Padronização de Termos **Problema**: Falta de padronização do idioma em todo o portal e uso do termo "Dashboard" em vez de "Painel". **Solução**: - **Localização**: Verificado que o `index.html` principal já continha a tag `lang="pt-BR"`, garantindo a configuração de idioma correta para todo o site. - **Substituição de Termos**: Todas as ocorrências visíveis do termo "Dashboard" foram substituídas por "Painel" para melhorar a usabilidade e a consistência da linguagem para o público-alvo. - **Exemplos**: "Blog Dashboard" virou "Painel do Blog", "Dashboard Empresa" virou "Painel Empresa". - **Observação**: Nomes de componentes, arquivos e rotas foram mantidos com "Dashboard" para evitar quebras no código. **Arquivos modificados**: - `src/components/layout/Header.tsx` - `src/pages/BlogDashboard.tsx` - `src/pages/ConfirmacaoPagamento.tsx` e outros. --- **Data**: 21 de outubro de 2025   **Responsável**: Manus AI '''
